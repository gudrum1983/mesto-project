(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{S:()=>Q});var t=function(e){alert("Упс...что-то пошло не так! Попейте вкусного чая, а потом попробуйте снова!\nС любовью, Екатерина и команда Яндекс практикум!"),console.log("Запрос не выполнен. ".concat(e,"."))},n=document.forms["profile-form"],r=document.querySelector(".card-grid"),o=document.querySelector(".popup_type_place"),a=document.forms["card-form"],i=document.forms["delete-form"],c=document.forms["avatar-form"],u=document.querySelector(".popup_type_avatar"),s=document.querySelector(".profile__avatar"),l=document.querySelector(".profile__name"),d=document.querySelector(".profile__status"),f={overlayClass:"popup__shadow",closeButtonClass:"popup__button-close",openingPopupClass:"popup_opened",openingPopupSelector:".popup_opened"};function p(e){var t=e.target;(t.classList.contains(f.overlayClass)||t.classList.contains(f.closeButtonClass))&&y(e.currentTarget)}function m(e){"Escape"===e.key&&y(document.querySelector(f.openingPopupSelector))}function v(e){e.classList.add(f.openingPopupClass),document.addEventListener("keyup",m),e.addEventListener("click",p)}function y(e){e.classList.remove(f.openingPopupClass),document.removeEventListener("keyup",m),e.removeEventListener("click",p)}function _(e,t,n){e.disabled=!0,n.length>0&&e.classList.add(t.inactiveButtonClass)}function h(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function b(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?h(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}function S(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):_(t,n,e)}function g(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector),o=n.every((function(e){return 0===e.value.length}));0===n.length?r.disabled=!1:o?(_(r,t,n),n.forEach((function(n){h(e,n,t)}))):(S(n,r,t),n.forEach((function(o){b(e,o,t),S(n,r,t)})))}function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==q(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==q(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===q(o)?o:String(o)),r)}var o}var C=new(function(){function e(t){var n=t.baseUrl,r=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=n,this._headers=r,this._endpoints={user:"/users/me",avatar:"/users/me/avatar",cards:"/cards",likes:"/cards/likes"}}var t,n;return t=e,(n=[{key:"_checkResponse",value:function(e){return e.ok?e.json():promise.reject("Ошибка подключения к серверу")}},{key:"_request",value:function(e,t){return fetch("".concat(this._baseUrl).concat(e),t).then(this._checkResponse)}},{key:"getTotalInfoOOP",value:function(){return Promise.all([this._request(this._endpoints.user,{headers:this._headers}),this._request(this._endpoints.cards,{headers:this._headers})])}},{key:"sendProfileOOP",value:function(e,t){return this._request(this._endpoints.user,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})})}},{key:"sendAvatarOOP",value:function(e){return this._request(this._endpoints.avatar,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})})}},{key:"sendNewCardOOP",value:function(e,t){return this._request(this._endpoints.cards,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:e})})}},{key:"sendCardDeletionOOP",value:function(e){return this._request("".concat(this._endpoints.cards,"/").concat(e),{method:"DELETE",headers:this._headers})}},{key:"sendStatusLikeOOP",value:function(e,t){return this._request("".concat(this._endpoints.likes,"/").concat(e),{method:t?"DELETE":"PUT",headers:this._headers})}}])&&k(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}())({baseUrl:"https://nomoreparties.co/v1/plus-cohort-25",headers:{authorization:"18a46d0a-0ce8-4b72-9f50-a83304389d2f","Content-Type":"application/json"}}),O=document.querySelector("#itemTemplate").content,E=document.querySelector(".popup_type_zoom"),L=E.querySelector(".zoom__photo"),P=E.querySelector(".zoom__caption"),A=document.querySelector(".popup_type_delete"),w=A.querySelector(".form__button-submit");function j(e,n,o){var a,i,c=(i=n,(a=e.likes).length>0&&a.map((function(e){return e._id})).includes(i)),u=e.owner._id===n,s=function(e,n,r,o,a,i){var c=O.cloneNode(!0),u=c.querySelector(".card__photo");u.src=n,u.alt="Визуальное отображение места - ".concat(e),u.addEventListener("click",(function(){return t=n,r=e,L.setAttribute("alt","Визуальное отображение места - ".concat(r)),L.setAttribute("src",t),P.textContent=r,void v(E);var t,r}));var s=c.querySelector(".card__like-number"),l=c.querySelector(".card__like");s.textContent=o.length,l.addEventListener("click",(function(){return function(e,n,r){var o=e.classList.contains("card__like_active");!function(e,n,r,o){C.sendStatusLikeOOP(e,o).then((function(e){r.textContent=e.likes.length,o?n.classList.remove("card__like_active"):n.classList.add("card__like_active")})).catch(t)}(r,e,n,o)}(l,s,r)})),a&&l.classList.add("card__like_active");var d=c.querySelector(".card__trash");return i?d.addEventListener("click",(function(){return function(e,t){(function(e){var t=document.querySelectorAll('.card[data-deleted = "true"]');t.length>0&&t.forEach((function(e){delete e.dataset.deleted})),e.closest(".card").dataset.deleted=!0})(e),w.value=t,w.disabled=!1,Q()}(d,r)})):d.remove(),c.querySelector(".card__title").textContent=e,c}(e.name,e.link,e._id,e.likes,c,u);o?r.append(s):r.prepend(s)}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var T,B=null,N=document.querySelector(".profile__button-edit"),U=document.querySelector(".profile__button-add"),D=document.querySelector(".profile__avatar-button"),I=document.querySelector(".popup_type_profile"),z=n.querySelector('[name="user-name"]'),M=n.querySelector('[name="user-status"]'),J=a.querySelector('[name="title"]'),H=a.querySelector('[name="link-img"]'),R=c.querySelector('[name="link-avatar"]'),V={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button-submit",inactiveButtonClass:"form__submit_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__error_active"};function $(e,t){l.textContent=e,d.textContent=t}function F(e){s.src=e}function G(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";e?(t.disabled=e,t.textContent=r):t.textContent=n}function K(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";t.preventDefault();var r=t.submitter,o=r.textContent;G(!0,r,o,n),e().then((function(){t.target.reset()})).catch((function(e){console.error("Ошибка: ".concat(e))})).finally((function(){G(!1,r,o)}))}function Q(){g(i,V),v(A)}N.addEventListener("click",(function(){z.value=l.textContent,M.value=d.textContent,g(n,V),v(I)})),U.addEventListener("click",(function(){g(a,V),v(o)})),D.addEventListener("click",(function(){g(c,V),v(u)})),n.addEventListener("submit",(function(e){K((function(){return C.sendProfileOOP(z.value,M.value).then((function(e){y(I),$(e.name,e.about)}))}),e)})),a.addEventListener("submit",(function(e){K((function(){return C.sendNewCardOOP(H.value,J.value).then((function(e){j(e,B,!1),y(o)}))}),e)})),c.addEventListener("submit",(function(e){K((function(){return C.sendAvatarOOP(R.value).then((function(e){F(e.avatar),y(u)}))}),e)})),i.addEventListener("submit",(function(e){var t=e.submitter.value;K((function(){return C.sendCardDeletionOOP(t).then((function(e){console.log(e.message),document.querySelector('.card[data-deleted = "true"]').remove(),y(A)}))}),e,"Удаление...")})),T=V,Array.from(document.querySelectorAll(T.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);S(n,r,t),e.addEventListener("reset",(function(){_(r,t,n)})),n.forEach((function(o){o.addEventListener("input",(function(){b(e,o,t),S(n,r,t)}))}))}(e,T)})),C.getTotalInfoOOP().then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],u=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw o}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],a=r[1];console.log(o),console.log(a),B=o._id,$(o.name,o.about),F(o.avatar),function(e,t){e.forEach((function(e){j(e,t,!0)}))}(a,B)})).catch(t)})();